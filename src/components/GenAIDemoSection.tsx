import React, { useState, useRef, useEffect } from 'react';
import { Brain, Send, Bot, User, Zap, FileText, Wrench, BookOpen, BarChart3, Shield, Users, TrendingUp } from 'lucide-react';

interface GenAIDemoSectionProps {
  onComplete: () => void;
}

interface Message {
  id: number;
  content: string;
  sender: 'user' | 'assistant';
  timestamp: Date;
}

interface UseCase {
  id: string;
  title: string;
  icon: React.ComponentType<any>;
  color: string;
  description: string;
  quickQueries: string[];
}

const useCases: UseCase[] = [
  {
    id: 'production',
    title: 'Production Performance Chat',
    icon: BarChart3,
    color: 'blue',
    description: 'Real-time production analytics, OEE monitoring, and performance insights',
    quickQueries: [
      'What is our current OEE across all lines?',
      'Show me today\'s production metrics',
      'Which line has the highest downtime?',
      'Compare this week vs last week performance',
      'What are the main quality issues today?',
      'Predict tomorrow\'s production capacity'
    ]
  },
  {
    id: 'sop',
    title: 'SOP Generator',
    icon: FileText,
    color: 'green',
    description: 'Generate comprehensive SOPs for blood bag manufacturing processes',
    quickQueries: [
      'Create SOP for RF welding process',
      'Generate cleanroom entry procedure',
      'Write quality inspection checklist',
      'Create equipment calibration SOP'
    ]
  },
  {
    id: 'troubleshoot',
    title: 'Troubleshooting Assistant',
    icon: Wrench,
    color: 'orange',
    description: 'AI-powered assistant to diagnose and resolve production issues',
    quickQueries: [
      'Weak seal strength on Line 3',
      'Extruder temperature fluctuations',
      'Autoclave pressure issues',
      'Packaging machine jamming frequently'
    ]
  },
  {
    id: 'training',
    title: 'Training Content Creator',
    icon: BookOpen,
    color: 'purple',
    description: 'Generate customized training materials for operators and engineers',
    quickQueries: [
      'Create operator training for new hires',
      'Generate quality control training module',
      'Write safety protocol training',
      'Create equipment operation guide'
    ]
  },
  {
    id: 'compliance',
    title: 'Compliance Assistant',
    icon: Shield,
    color: 'red',
    description: 'Verify compliance with FDA, ISO 13485, and regulatory requirements',
    quickQueries: [
      'Check ISO 13485 compliance status',
      'Review FDA 21 CFR Part 820 requirements',
      'Generate audit preparation checklist',
      'Validate documentation completeness'
    ]
  },
  {
    id: 'optimization',
    title: 'Process Optimizer',
    icon: TrendingUp,
    color: 'teal',
    description: 'Analyze production data to identify optimization opportunities',
    quickQueries: [
      'Optimize changeover times',
      'Reduce material waste',
      'Improve line efficiency',
      'Minimize energy consumption'
    ]
  }
];

const GenAIDemoSection: React.FC<GenAIDemoSectionProps> = ({ onComplete }) => {
  const [activeUseCase, setActiveUseCase] = useState('production');
  const [messages, setMessages] = useState<Message[]>([]);
  const [inputValue, setInputValue] = useState('');
  const [isTyping, setIsTyping] = useState(false);
  const [messageIdCounter, setMessageIdCounter] = useState(0);
  const messagesEndRef = useRef<HTMLDivElement>(null);
  const inputRef = useRef<HTMLTextAreaElement>(null);

  const currentUseCase = useCases.find(uc => uc.id === activeUseCase) || useCases[0];

  useEffect(() => {
    // Initialize with welcome message
    const welcomeMessage: Message = {
      id: messageIdCounter,
      content: getWelcomeMessage(activeUseCase),
      sender: 'assistant',
      timestamp: new Date()
    };
    setMessages([welcomeMessage]);
    setMessageIdCounter(1);
  }, [activeUseCase]);

  useEffect(() => {
    scrollToBottom();
  }, [messages, isTyping]);

  const scrollToBottom = () => {
    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
  };

  const getWelcomeMessage = (useCaseId: string): string => {
    const welcomeMessages = {
      production: `Hello! I'm your Production Performance Assistant. I can help you with:

üìä Real-time OEE monitoring
üìà Production trend analysis  
‚è±Ô∏è Downtime investigation
üéØ Performance benchmarking
üîç Quality metrics review
üìÖ Capacity planning

What would you like to know about your production performance?`,
      sop: `Hi! I'm your SOP Generator Assistant. I can help create comprehensive Standard Operating Procedures for:

üìã Blood bag assembly processes
üß™ Quality control procedures
üè≠ Equipment operation protocols
üßº Cleanroom procedures
‚öôÔ∏è Maintenance procedures

What SOP would you like me to generate?`,
      troubleshoot: `Hello! I'm your Troubleshooting Assistant. I can help diagnose and resolve:

üîß Equipment malfunctions
‚ö†Ô∏è Quality issues
üå°Ô∏è Process parameter deviations
‚è∞ Production delays
üîç Root cause analysis

Describe the issue you're experiencing and I'll help you solve it.`,
      training: `Hi! I'm your Training Content Creator. I can generate:

üë• Operator training materials
üìö Technical documentation
üéØ Skill assessment guides
üìã Safety training modules
üèÜ Certification programs

What type of training content do you need?`,
      compliance: `Hello! I'm your Compliance Assistant. I can help with:

‚úÖ Regulatory requirement verification
üìã Audit preparation
üìÑ Documentation review
üèõÔ∏è Standards compliance (ISO 13485, FDA)
üìä Compliance reporting

What compliance area would you like to review?`,
      optimization: `Hi! I'm your Process Optimization Assistant. I can analyze:

üìà Production efficiency opportunities
‚ö° Energy consumption reduction
üîÑ Workflow improvements
üìä Resource utilization
üí∞ Cost optimization strategies

What process would you like to optimize?`
    };
    
    return welcomeMessages[useCaseId as keyof typeof welcomeMessages] || welcomeMessages.production;
  };

  const handleSendMessage = async () => {
    if (!inputValue.trim()) return;

    const userMessage: Message = {
      id: messageIdCounter,
      content: inputValue.trim(),
      sender: 'user',
      timestamp: new Date()
    };

    setMessages(prev => [...prev, userMessage]);
    setMessageIdCounter(prev => prev + 1);
    setInputValue('');
    setIsTyping(true);

    // Simulate AI response delay
    setTimeout(() => {
      const aiResponse = generateAIResponse(inputValue.trim(), activeUseCase);
      const assistantMessage: Message = {
        id: messageIdCounter + 1,
        content: aiResponse,
        sender: 'assistant',
        timestamp: new Date()
      };

      setMessages(prev => [...prev, assistantMessage]);
      setMessageIdCounter(prev => prev + 2);
      setIsTyping(false);
    }, 1500 + Math.random() * 1000);
  };

  const handleQuickQuery = (query: string) => {
    setInputValue(query);
    setTimeout(() => {
      handleSendMessage();
    }, 100);
  };

  const handleKeyPress = (e: React.KeyboardEvent) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      handleSendMessage();
    }
  };

  const generateAIResponse = (message: string, useCaseId: string): string => {
    const lowerMessage = message.toLowerCase();

    if (useCaseId === 'production') {
      return generateProductionResponse(lowerMessage);
    } else if (useCaseId === 'sop') {
      return generateSOPResponse(lowerMessage);
    } else if (useCaseId === 'troubleshoot') {
      return generateTroubleshootResponse(lowerMessage);
    } else if (useCaseId === 'training') {
      return generateTrainingResponse(lowerMessage);
    } else if (useCaseId === 'compliance') {
      return generateComplianceResponse(lowerMessage);
    } else if (useCaseId === 'optimization') {
      return generateOptimizationResponse(lowerMessage);
    }

    return "I'm here to help! Could you please be more specific about what you'd like to know?";
  };

  const generateProductionResponse = (message: string): string => {
    if (message.includes('oee') || message.includes('overall equipment effectiveness')) {
      return `üìä **Current OEE Status:**

**Line 1:** 82% (Target: 85%)
**Line 2:** 78% (Target: 85%) 
**Line 3:** 76% (Target: 85%)
**Line 4:** 81% (Target: 85%)

**Overall Plant OEE: 79.25%**

üìâ Line 3 showing lowest performance due to recent welding issues.
üéØ **Recommendation:** Focus maintenance on Line 3 RF welding machine.

Would you like me to analyze the root causes for Line 3's performance?`;
    }

    if (message.includes('production') && (message.includes('today') || message.includes('metrics'))) {
      return `üìà **Today's Production Metrics:**

üéØ **Target:** 12,000 units
‚úÖ **Actual:** 10,850 units (90.4%)
‚è∞ **Time Remaining:** 2.5 hours

**Line Performance:**
‚Ä¢ Line 1: 2,780 units (103% of target)
‚Ä¢ Line 2: 2,650 units (98% of target)  
‚Ä¢ Line 3: 2,420 units (85% of target) ‚ö†Ô∏è
‚Ä¢ Line 4: 3,000 units (107% of target)

üìä **Quality Rate:** 98.2%
‚è±Ô∏è **Average Cycle Time:** 2.4 minutes

Line 4 is performing exceptionally well today! Would you like details on what's driving their success?`;
    }

    if (message.includes('downtime')) {
      return `‚è∞ **Downtime Analysis:**

**Highest Downtime - Line 3:**
Total Downtime Today: 3.2 hours

üîß **Planned Maintenance:** 1.5 hours
‚ö†Ô∏è **Unplanned Stops:** 1.7 hours

**Root Causes:**
‚Ä¢ RF Welding calibration: 45 min
‚Ä¢ Material changeover: 35 min
‚Ä¢ Quality hold: 25 min
‚Ä¢ Equipment adjustment: 25 min

üí° **Action Items:**
1. Schedule welding machine PM
2. Implement SMED for changeovers
3. Review quality parameters

Would you like me to create a detailed action plan for reducing Line 3 downtime?`;
    }

    if (message.includes('week') && message.includes('compar')) {
      return `üìä **Weekly Performance Comparison:**

**This Week vs Last Week:**

üìà **Production Volume:** +5.2%
(58,500 vs 55,600 units)

üìä **OEE:** +2.1%
(79.2% vs 77.1%)

‚úÖ **Quality Yield:** +0.8%
(98.1% vs 97.3%)

‚è∞ **Downtime:** -15%
(18.5 hrs vs 21.8 hrs)

üéØ **Key Improvements:**
‚Ä¢ Reduced changeover times
‚Ä¢ Better material flow  
‚Ä¢ Proactive maintenance

üìà **Trending positively overall!** The team's focus on continuous improvement is paying off.`;
    }

    if (message.includes('quality') && message.includes('issue')) {
      return `üîç **Today's Quality Issues:**

**Total Rejects:** 183 units (1.8%)

üìã **Breakdown by Defect Type:**
‚Ä¢ Weak seals: 78 units (0.76%)
‚Ä¢ Dimensional issues: 45 units (0.44%)
‚Ä¢ Leak failures: 32 units (0.31%)
‚Ä¢ Label defects: 28 units (0.27%)

üéØ **Primary Concern:**
Line 3 seal strength - investigating welding parameters

‚úÖ **Actions Taken:**
1. Parameter adjustment completed
2. Increased sampling frequency
3. Operator retrained

üìà **Improvement trend observed in last 2 hours**

Would you like me to generate a detailed quality improvement plan?`;
    }

    if (message.includes('predict') || message.includes('forecast') || message.includes('capacity')) {
      return `üîÆ **Tomorrow's Production Forecast:**

**Predicted Capacity:** 11,800 units
(Based on current OEE trends)

üìä **Line Forecasts:**
‚Ä¢ Line 1: 3,100 units (Excellent condition)
‚Ä¢ Line 2: 2,950 units (Good condition)
‚Ä¢ Line 3: 2,650 units (Post-maintenance) ‚ö†Ô∏è
‚Ä¢ Line 4: 3,100 units (Excellent condition)

‚ö†Ô∏è **Risk Factors:**
‚Ä¢ Line 3 post-maintenance verification
‚Ä¢ Weather forecast (potential power issues)
‚Ä¢ Material delivery scheduled for 10 AM

üí° **Recommendations:**
‚Ä¢ Complete Line 3 validation early
‚Ä¢ Pre-position emergency materials
‚Ä¢ Schedule preventive maintenance for weekend`;
    }

    return `I can help you analyze production data. Here are some areas I can assist with:

üìä OEE analysis and trends
‚è∞ Downtime root cause analysis  
üéØ Quality metrics tracking
‚ö° Energy consumption monitoring
üìÖ Capacity planning
üîß Equipment performance

What specific aspect would you like to explore?`;
  };

  const generateSOPResponse = (message: string): string => {
    if (message.includes('rf welding') || message.includes('welding')) {
      return `üìã **RF Welding SOP Generated:**

**STANDARD OPERATING PROCEDURE**
**Document:** SOP-PRD-001 | **Version:** 2.0

**TITLE:** Blood Bag Assembly - RF Welding Process

**1. PURPOSE**
Establish standardized procedures for blood bag assembly using RF welding equipment in ISO Class 3 cleanroom.

**2. EQUIPMENT & MATERIALS**
‚Ä¢ RF Welding Machine (Model: XYZ-2000)
‚Ä¢ Medical grade PVC sheets (DEHP-free)
‚Ä¢ Tubing components (pre-sterilized)
‚Ä¢ Cleanroom garments (Class 3 compliant)

**3. CRITICAL PARAMETERS**
‚Ä¢ Welding temperature: 130¬∞C ¬± 5¬∞C
‚Ä¢ Dwell time: 3.5 seconds ¬± 0.2s
‚Ä¢ Cooling time: Minimum 2 seconds
‚Ä¢ Weld strength: >15 N

**4. PROCEDURE STEPS**
‚úÖ Pre-operation checks
‚úÖ Material preparation
‚úÖ Welding process execution
‚úÖ Quality verification
‚úÖ Documentation

Would you like me to expand on any specific section or generate additional SOPs?`;
    }

    if (message.includes('cleanroom') || message.includes('entry')) {
      return `üßº **Cleanroom Entry SOP Generated:**

**CLEANROOM ENTRY PROCEDURE**
**Document:** SOP-FAC-003 | **Class:** ISO 3

**ENTRY SEQUENCE:**

**1. PRE-ENTRY (Changing Room 1)**
‚Ä¢ Remove street clothes and jewelry
‚Ä¢ Put on disposable shoe covers
‚Ä¢ Wash hands thoroughly (30 seconds minimum)

**2. GOWNING (Changing Room 2)**  
‚Ä¢ Don sterile undergarments
‚Ä¢ Put on cleanroom suit (head to toe)
‚Ä¢ Install face mask and hair cover
‚Ä¢ Put on sterile gloves

**3. AIRLOCK ENTRY**
‚Ä¢ Enter through personnel airlock
‚Ä¢ Wait for air shower cycle (30 seconds)
‚Ä¢ Verify pressure differential >15 Pa

**4. FINAL VERIFICATION**
‚Ä¢ Check gown integrity
‚Ä¢ Verify no exposed skin/hair
‚Ä¢ Log entry time and personnel ID

**CRITICAL CONTROLS:**
‚Ä¢ Particle count monitoring
‚Ä¢ Pressure differential alarms
‚Ä¢ Personnel training verification

Need SOPs for other cleanroom procedures?`;
    }

    return `üìã I can generate comprehensive SOPs for various processes:

üè≠ **Manufacturing Processes:**
‚Ä¢ Blood bag assembly
‚Ä¢ RF welding procedures
‚Ä¢ Quality inspection
‚Ä¢ Packaging operations

üß™ **Quality Procedures:**
‚Ä¢ Testing protocols
‚Ä¢ Calibration procedures
‚Ä¢ Documentation requirements

üßº **Facility Procedures:**
‚Ä¢ Cleanroom protocols
‚Ä¢ Equipment maintenance
‚Ä¢ Safety procedures

What specific SOP would you like me to create?`;
  };

  const generateTroubleshootResponse = (message: string): string => {
    if (message.includes('weak seal') || message.includes('seal strength')) {
      return `üîß **Weak Seal Strength Diagnosis:**

**IMMEDIATE ACTIONS:**
1. ‚è∏Ô∏è Stop production on affected line
2. üîç Isolate suspect units for testing
3. üìä Review last 4 hours of process data

**ROOT CAUSE ANALYSIS:**

**Most Likely Causes:**
üå°Ô∏è **Temperature Deviation** (85% probability)
‚Ä¢ Check welding head temperature
‚Ä¢ Verify thermocouple calibration
‚Ä¢ Review heating element condition

‚è±Ô∏è **Timing Issues** (60% probability)  
‚Ä¢ Validate dwell time settings
‚Ä¢ Check pneumatic response time
‚Ä¢ Verify PLC program integrity

üîß **Mechanical Issues** (40% probability)
‚Ä¢ Inspect welding dies for wear
‚Ä¢ Check pressure settings
‚Ä¢ Verify alignment

**CORRECTIVE ACTIONS:**
1. Recalibrate temperature controller
2. Replace worn welding dies
3. Adjust pressure to 4.2 bar
4. Retrain operator on parameters

**VERIFICATION:**
‚Ä¢ Run 10 test samples
‚Ä¢ Perform pull tests (>15N required)
‚Ä¢ Document results

Would you like me to create a detailed troubleshooting checklist?`;
    }

    if (message.includes('temperature') && message.includes('fluctuat')) {
      return `üå°Ô∏è **Temperature Fluctuation Diagnosis:**

**SYMPTOM ANALYSIS:**
Extruder temperature showing ¬±8¬∞C variation (normal: ¬±2¬∞C)

**INVESTIGATION STEPS:**

**1. SENSOR VERIFICATION**
‚Ä¢ Check thermocouple connections
‚Ä¢ Verify sensor calibration date
‚Ä¢ Test with portable thermometer

**2. CONTROL SYSTEM**
‚Ä¢ Review PID controller settings
‚Ä¢ Check for electrical interference
‚Ä¢ Verify power supply stability

**3. MECHANICAL CAUSES**
‚Ä¢ Inspect heating elements
‚Ä¢ Check insulation integrity
‚Ä¢ Verify cooling system operation

**IMMEDIATE FIXES:**
‚úÖ Tighten thermocouple connections
‚úÖ Adjust PID parameters (P=2.5, I=0.8, D=0.1)
‚úÖ Schedule heating element inspection

**PREVENTIVE MEASURES:**
‚Ä¢ Monthly sensor calibration
‚Ä¢ Quarterly insulation check
‚Ä¢ Annual heating element replacement

**EXPECTED RESULT:**
Temperature stability within ¬±2¬∞C within 2 hours

Need help with other equipment issues?`;
    }

    return `üõ†Ô∏è **Troubleshooting Assistant Ready**

I can help diagnose and resolve:

‚öôÔ∏è **Equipment Issues:**
‚Ä¢ RF welding problems
‚Ä¢ Extruder malfunctions  
‚Ä¢ Autoclave issues
‚Ä¢ Packaging machine problems

üîç **Quality Problems:**
‚Ä¢ Seal strength issues
‚Ä¢ Dimensional variations
‚Ä¢ Leak test failures
‚Ä¢ Visual defects

üìä **Process Deviations:**
‚Ä¢ Temperature fluctuations
‚Ä¢ Pressure variations
‚Ä¢ Timing issues
‚Ä¢ Material flow problems

Describe your specific issue and I'll provide detailed troubleshooting steps!`;
  };

  const generateTrainingResponse = (message: string): string => {
    if (message.includes('new hire') || message.includes('operator training')) {
      return `üë• **New Operator Training Program Generated:**

**BLOOD BAG MANUFACTURING - NEW HIRE TRAINING**

**WEEK 1: FOUNDATIONS**
üìö **Day 1-2: Orientation**
‚Ä¢ Company history and values
‚Ä¢ Product overview and applications
‚Ä¢ Quality management system
‚Ä¢ Safety protocols and emergency procedures

üìã **Day 3-5: Basic Procedures**
‚Ä¢ Cleanroom protocols and gowning
‚Ä¢ Hand hygiene and contamination control
‚Ä¢ Documentation requirements
‚Ä¢ Basic equipment familiarization

**WEEK 2: PROCESS TRAINING**
üè≠ **Production Process:**
‚Ä¢ Material handling procedures
‚Ä¢ RF welding operation basics
‚Ä¢ Quality checkpoints
‚Ä¢ Batch record completion

**WEEK 3: HANDS-ON PRACTICE**
üë®‚Äçüè´ **Supervised Operation:**
‚Ä¢ Shadow experienced operator
‚Ä¢ Practice under supervision
‚Ä¢ Gradual responsibility increase
‚Ä¢ Skills assessment

**ASSESSMENT CRITERIA:**
‚úÖ Safety protocol compliance (100%)
‚úÖ Quality procedure adherence (95%)
‚úÖ Documentation accuracy (98%)
‚úÖ Production rate targets (80% by week 3)

**CERTIFICATION REQUIREMENTS:**
‚Ä¢ Written exam (80% minimum)
‚Ä¢ Practical demonstration
‚Ä¢ Supervisor sign-off

Would you like me to detail any specific training module?`;
    }

    if (message.includes('quality control') || message.includes('quality training')) {
      return `üîç **Quality Control Training Module:**

**QUALITY INSPECTOR CERTIFICATION PROGRAM**

**MODULE 1: QUALITY FUNDAMENTALS**
üìä **Quality Management System**
‚Ä¢ ISO 13485 requirements
‚Ä¢ Risk-based thinking
‚Ä¢ Process approach
‚Ä¢ Continuous improvement

**MODULE 2: INSPECTION TECHNIQUES**
üî¨ **Visual Inspection:**
‚Ä¢ Defect identification
‚Ä¢ Measurement techniques
‚Ä¢ Sampling procedures
‚Ä¢ Documentation requirements

**MODULE 3: TESTING PROCEDURES**
üß™ **Laboratory Tests:**
‚Ä¢ Leak testing methodology
‚Ä¢ Tensile strength testing
‚Ä¢ Dimensional verification
‚Ä¢ Sterility testing basics

**MODULE 4: DATA ANALYSIS**
üìà **Statistical Methods:**
‚Ä¢ Control charts
‚Ä¢ Capability studies
‚Ä¢ Trend analysis
‚Ä¢ Corrective action protocols

**PRACTICAL EXERCISES:**
‚Ä¢ Defect classification workshop
‚Ä¢ Measurement system analysis
‚Ä¢ Non-conformance investigation
‚Ä¢ Audit techniques

**CERTIFICATION:**
‚Ä¢ Theory exam (85% minimum)
‚Ä¢ Practical assessment
‚Ä¢ Ongoing competency verification

Need training materials for other roles?`;
    }

    return `üìö **Training Content Creator**

I can develop comprehensive training materials for:

üë• **Personnel Training:**
‚Ä¢ New hire orientation
‚Ä¢ Operator skill development
‚Ä¢ Supervisor leadership training
‚Ä¢ Cross-training programs

üéØ **Technical Training:**
‚Ä¢ Equipment operation
‚Ä¢ Quality control procedures
‚Ä¢ Maintenance techniques
‚Ä¢ Safety protocols

üìã **Compliance Training:**
‚Ä¢ Regulatory requirements
‚Ä¢ Audit preparation
‚Ä¢ Documentation standards
‚Ä¢ Change control procedures

What specific training content would you like me to develop?`;
  };

  const generateComplianceResponse = (message: string): string => {
    if (message.includes('iso 13485') || message.includes('iso')) {
      return `‚úÖ **ISO 13485 Compliance Status:**

**CURRENT COMPLIANCE LEVEL: 94%**

**COMPLIANT AREAS:**
‚úÖ **Management System** (100%)
‚Ä¢ Quality policy established
‚Ä¢ Management review process active
‚Ä¢ Resource management adequate

‚úÖ **Design Controls** (98%)
‚Ä¢ Design planning documented
‚Ä¢ Design inputs/outputs defined
‚Ä¢ Design verification completed

‚úÖ **Production Controls** (92%)
‚Ä¢ Process validation completed
‚Ä¢ Work instructions current
‚Ä¢ Equipment qualification active

**AREAS NEEDING ATTENTION:**
‚ö†Ô∏è **Risk Management** (85%)
‚Ä¢ Risk analysis needs updating
‚Ä¢ Post-market surveillance gaps
‚Ä¢ Clinical evaluation incomplete

‚ö†Ô∏è **Corrective Actions** (88%)
‚Ä¢ CAPA trending analysis needed
‚Ä¢ Root cause analysis improvements
‚Ä¢ Effectiveness verification gaps

**ACTION PLAN:**
1. üìã Update risk management file
2. üîç Enhance post-market surveillance
3. üìä Improve CAPA trending
4. üéØ Schedule internal audit

**NEXT AUDIT:** March 2024
**CERTIFICATION EXPIRES:** June 2025

Would you like detailed recommendations for any specific clause?`;
    }

    if (message.includes('fda') || message.includes('21 cfr')) {
      return `üèõÔ∏è **FDA 21 CFR Part 820 Compliance Review:**

**QSR COMPLIANCE STATUS: 91%**

**STRONG AREAS:**
‚úÖ **Design Controls (820.30)** - 96%
‚Ä¢ Design history files complete
‚Ä¢ Design reviews documented
‚Ä¢ Verification/validation records current

‚úÖ **Production Controls (820.70)** - 94%
‚Ä¢ Process validation completed
‚Ä¢ Work instructions adequate
‚Ä¢ Environmental controls verified

**IMPROVEMENT AREAS:**
‚ö†Ô∏è **Management Controls (820.20)** - 85%
‚Ä¢ Management review frequency
‚Ä¢ Resource allocation documentation
‚Ä¢ Training record completeness

‚ö†Ô∏è **Corrective Actions (820.100)** - 87%
‚Ä¢ Investigation timeliness
‚Ä¢ Effectiveness verification
‚Ä¢ Trend analysis gaps

**CRITICAL REQUIREMENTS:**
üîç **Device History Record (DHR)**
‚Ä¢ Batch documentation complete
‚Ä¢ Traceability maintained
‚Ä¢ Quality data recorded

üìã **Design History File (DHF)**
‚Ä¢ All design phases documented
‚Ä¢ Risk analysis current
‚Ä¢ Clinical data adequate

**RECOMMENDATIONS:**
1. Enhance management review process
2. Improve CAPA investigation timelines
3. Strengthen training documentation
4. Update risk management procedures

Ready for FDA inspection? Let me help prepare!`;
    }

    return `üõ°Ô∏è **Compliance Assistant**

I can help verify compliance with:

üìã **Quality Standards:**
‚Ä¢ ISO 13485:2016 (Medical Devices)
‚Ä¢ ISO 9001:2015 (Quality Management)
‚Ä¢ ISO 14971 (Risk Management)

üèõÔ∏è **Regulatory Requirements:**
‚Ä¢ FDA 21 CFR Part 820 (QSR)
‚Ä¢ EU MDR 2017/745
‚Ä¢ Health Canada CMDCAS

üåç **International Standards:**
‚Ä¢ WHO Good Manufacturing Practice
‚Ä¢ Japanese PMDA requirements
‚Ä¢ Brazilian ANVISA regulations

What specific compliance area would you like me to review?`;
  };

  const generateOptimizationResponse = (message: string): string => {
    if (message.includes('changeover') || message.includes('setup')) {
      return `üîÑ **Changeover Time Optimization Analysis:**

**CURRENT STATE:**
‚è±Ô∏è **Average Changeover Time:** 45 minutes
üéØ **Target:** 20 minutes (SMED methodology)

**TIME BREAKDOWN:**
‚Ä¢ Equipment shutdown: 8 minutes
‚Ä¢ Cleaning/sanitization: 15 minutes  
‚Ä¢ Die/tooling change: 12 minutes
‚Ä¢ Setup/calibration: 7 minutes
‚Ä¢ First article approval: 3 minutes

**OPTIMIZATION OPPORTUNITIES:**

**1. EXTERNAL SETUP (15 min savings)**
‚Ä¢ Pre-stage next product materials
‚Ä¢ Prepare tooling during production
‚Ä¢ Pre-mix cleaning solutions
‚Ä¢ Ready calibration equipment

**2. PARALLEL ACTIVITIES (8 min savings)**
‚Ä¢ Simultaneous cleaning operations
‚Ä¢ Parallel die changes (2 operators)
‚Ä¢ Concurrent calibration checks

**3. STANDARDIZATION (5 min savings)**
‚Ä¢ Standard tool heights
‚Ä¢ Quick-connect fittings
‚Ä¢ Color-coded components
‚Ä¢ Visual setup guides

**IMPLEMENTATION PLAN:**
üìÖ **Week 1:** External setup preparation
üìÖ **Week 2:** Parallel activity training
üìÖ **Week 3:** Standardization implementation
üìÖ **Week 4:** Full SMED deployment

**EXPECTED RESULTS:**
‚Ä¢ 56% reduction in changeover time
‚Ä¢ 12% increase in production capacity
‚Ä¢ ‚Çπ2.8M annual savings

Would you like detailed implementation steps?`;
    }

    if (message.includes('waste') || message.includes('material')) {
      return `‚ôªÔ∏è **Material Waste Reduction Analysis:**

**CURRENT WASTE LEVELS:**
üìä **Total Material Waste:** 3.2% of input
üéØ **Industry Benchmark:** 1.8%
üí∞ **Annual Waste Cost:** ‚Çπ4.2M

**WASTE BREAKDOWN:**
‚Ä¢ Startup/shutdown waste: 1.1%
‚Ä¢ Quality rejects: 0.9%
‚Ä¢ Changeover waste: 0.7%
‚Ä¢ Trim/edge waste: 0.5%

**OPTIMIZATION STRATEGIES:**

**1. STARTUP OPTIMIZATION**
‚Ä¢ Reduce warm-up material usage
‚Ä¢ Implement predictive heating
‚Ä¢ Optimize parameter ramp-up
**Potential Savings:** 0.6%

**2. QUALITY IMPROVEMENT**
‚Ä¢ Enhanced process control
‚Ä¢ Real-time monitoring
‚Ä¢ Predictive quality analytics
**Potential Savings:** 0.4%

**3. CHANGEOVER EFFICIENCY**
‚Ä¢ Minimize purge material
‚Ä¢ Optimize cleaning procedures
‚Ä¢ Reduce setup waste
**Potential Savings:** 0.3%

**4. DESIGN OPTIMIZATION**
‚Ä¢ Minimize trim requirements
‚Ä¢ Optimize nesting patterns
‚Ä¢ Reduce edge waste
**Potential Savings:** 0.2%

**TOTAL POTENTIAL REDUCTION:** 1.5%
**ANNUAL SAVINGS:** ‚Çπ2.6M

**IMPLEMENTATION PRIORITY:**
1. ü•á Startup optimization (quick wins)
2. ü•à Quality improvements (medium term)
3. ü•â Design changes (long term)

Ready to implement these improvements?`;
    }

    return `üìà **Process Optimization Assistant**

I can analyze and optimize:

‚ö° **Efficiency Improvements:**
‚Ä¢ Cycle time reduction
‚Ä¢ Changeover optimization
‚Ä¢ Throughput enhancement
‚Ä¢ Bottleneck elimination

üí∞ **Cost Reduction:**
‚Ä¢ Material waste minimization
‚Ä¢ Energy consumption optimization
‚Ä¢ Labor efficiency improvements
‚Ä¢ Maintenance cost reduction

üéØ **Quality Enhancement:**
‚Ä¢ Defect rate reduction
‚Ä¢ Process capability improvement
‚Ä¢ Variation reduction
‚Ä¢ First-pass yield optimization

What specific process would you like me to optimize?`;
  };

  const getColorClasses = (color: string) => {
    const colors = {
      blue: 'bg-blue-100 text-blue-800 border-blue-200',
      green: 'bg-green-100 text-green-800 border-green-200',
      orange: 'bg-orange-100 text-orange-800 border-orange-200',
      purple: 'bg-purple-100 text-purple-800 border-purple-200',
      red: 'bg-red-100 text-red-800 border-red-200',
      teal: 'bg-teal-100 text-teal-800 border-teal-200'
    };
    return colors[color as keyof typeof colors] || colors.blue;
  };

  const getButtonColor = (color: string) => {
    const colors = {
      blue: 'bg-blue-600 hover:bg-blue-700',
      green: 'bg-green-600 hover:bg-green-700',
      orange: 'bg-orange-600 hover:bg-orange-700',
      purple: 'bg-purple-600 hover:bg-purple-700',
      red: 'bg-red-600 hover:bg-red-700',
      teal: 'bg-teal-600 hover:bg-teal-700'
    };
    return colors[color as keyof typeof colors] || colors.blue;
  };

  return (
    <div className="space-y-8">
      {/* Header */}
      <div className="text-center bg-white rounded-xl shadow-lg p-6">
        <div className="w-16 h-16 bg-gradient-to-r from-indigo-600 to-purple-600 rounded-full mx-auto mb-4 flex items-center justify-center">
          <Brain className="w-8 h-8 text-white" />
        </div>
        <h1 className="text-3xl font-bold text-gray-900 mb-2">Generative AI Demo</h1>
        <p className="text-gray-600">AI-powered assistant for blood bag manufacturing excellence</p>
        
        {/* Stats */}
        <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mt-6 pt-6 border-t border-gray-200">
          <div className="text-center">
            <div className="text-2xl font-bold text-indigo-600">30M+</div>
            <div className="text-sm text-gray-600">Annual Production</div>
          </div>
          <div className="text-center">
            <div className="text-2xl font-bold text-indigo-600">130+</div>
            <div className="text-sm text-gray-600">Countries Served</div>
          </div>
          <div className="text-center">
            <div className="text-2xl font-bold text-indigo-600">ISO 13485</div>
            <div className="text-sm text-gray-600">Quality Certified</div>
          </div>
          <div className="text-center">
            <div className="text-2xl font-bold text-indigo-600">24/7</div>
            <div className="text-sm text-gray-600">AI Assistant Ready</div>
          </div>
        </div>
      </div>

      <div className="grid lg:grid-cols-4 gap-8">
        {/* Sidebar - Use Cases */}
        <div className="lg:col-span-1">
          <div className="bg-white rounded-xl shadow-lg p-6">
            <h3 className="text-lg font-semibold text-gray-900 mb-4">AI Use Cases</h3>
            <div className="space-y-2">
              {useCases.map((useCase) => {
                const Icon = useCase.icon;
                const isActive = activeUseCase === useCase.id;
                
                return (
                  <button
                    key={useCase.id}
                    onClick={() => setActiveUseCase(useCase.id)}
                    className={`w-full p-3 rounded-lg text-left transition-all duration-200 flex items-center space-x-3 ${
                      isActive 
                        ? `${getColorClasses(useCase.color)} border-2` 
                        : 'bg-gray-50 hover:bg-gray-100 text-gray-700'
                    }`}
                  >
                    <Icon className="w-5 h-5" />
                    <div>
                      <div className="font-medium text-sm">{useCase.title}</div>
                    </div>
                  </button>
                );
              })}
            </div>
          </div>
        </div>

        {/* Main Chat Area */}
        <div className="lg:col-span-3">
          <div className="bg-white rounded-xl shadow-lg overflow-hidden">
            {/* Chat Header */}
            <div className={`${getButtonColor(currentUseCase.color)} text-white p-4`}>
              <div className="flex items-center space-x-3">
                <currentUseCase.icon className="w-6 h-6" />
                <div>
                  <h3 className="font-semibold">{currentUseCase.title}</h3>
                  <p className="text-sm opacity-90">{currentUseCase.description}</p>
                </div>
                <div className="ml-auto text-sm opacity-80">
                  Status: Online ‚Ä¢ Real-time data enabled
                </div>
              </div>
            </div>

            {/* Quick Queries */}
            <div className="p-4 bg-gray-50 border-b">
              <div className="text-sm font-medium text-gray-700 mb-2">Quick Questions:</div>
              <div className="flex flex-wrap gap-2">
                {currentUseCase.quickQueries.slice(0, 4).map((query, index) => (
                  <button
                    key={index}
                    onClick={() => handleQuickQuery(query)}
                    className="px-3 py-1 bg-white border border-gray-200 rounded-full text-xs hover:border-indigo-300 hover:text-indigo-600 transition-colors duration-200"
                  >
                    {query}
                  </button>
                ))}
              </div>
            </div>

            {/* Messages */}
            <div className="h-96 overflow-y-auto p-4 bg-gray-50">
              {messages.map((message) => (
                <div
                  key={message.id}
                  className={`mb-4 flex ${message.sender === 'user' ? 'justify-end' : 'justify-start'}`}
                >
                  <div className={`max-w-xs lg:max-w-md xl:max-w-lg ${message.sender === 'user' ? 'order-2' : 'order-1'}`}>
                    <div
                      className={`p-3 rounded-lg ${
                        message.sender === 'user'
                          ? 'bg-indigo-600 text-white rounded-br-sm'
                          : 'bg-white border border-gray-200 text-gray-800 rounded-bl-sm'
                      }`}
                    >
                      <div className="whitespace-pre-wrap text-sm">{message.content}</div>
                    </div>
                    <div className="text-xs text-gray-500 mt-1 px-1">
                      {message.timestamp.toLocaleTimeString()}
                    </div>
                  </div>
                  <div className={`w-8 h-8 rounded-full flex items-center justify-center ${message.sender === 'user' ? 'order-1 ml-2' : 'order-2 mr-2'}`}>
                    {message.sender === 'user' ? (
                      <User className="w-5 h-5 text-gray-600" />
                    ) : (
                      <Bot className="w-5 h-5 text-indigo-600" />
                    )}
                  </div>
                </div>
              ))}
              
              {/* Typing Indicator */}
              {isTyping && (
                <div className="mb-4 flex justify-start">
                  <div className="max-w-xs lg:max-w-md xl:max-w-lg order-1">
                    <div className="bg-white border border-gray-200 text-gray-800 rounded-lg rounded-bl-sm p-3">
                      <div className="flex space-x-1">
                        <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce"></div>
                        <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{ animationDelay: '0.1s' }}></div>
                        <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{ animationDelay: '0.2s' }}></div>
                      </div>
                    </div>
                  </div>
                  <div className="w-8 h-8 rounded-full flex items-center justify-center order-2 mr-2">
                    <Bot className="w-5 h-5 text-indigo-600" />
                  </div>
                </div>
              )}
              <div ref={messagesEndRef} />
            </div>

            {/* Input Area */}
            <div className="p-4 border-t bg-white">
              <div className="flex space-x-3">
                <textarea
                  ref={inputRef}
                  value={inputValue}
                  onChange={(e) => setInputValue(e.target.value)}
                  onKeyPress={handleKeyPress}
                  placeholder={`Ask about ${currentUseCase.title.toLowerCase()}...`}
                  className="flex-1 p-3 border border-gray-300 rounded-lg resize-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                  rows={1}
                  style={{ minHeight: '44px', maxHeight: '120px' }}
                />
                <button
                  onClick={handleSendMessage}
                  disabled={!inputValue.trim() || isTyping}
                  className={`${getButtonColor(currentUseCase.color)} text-white p-3 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200`}
                >
                  <Send className="w-5 h-5" />
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      {/* Complete Section */}
      <div className="text-center bg-green-50 rounded-xl p-6">
        <h3 className="text-lg font-semibold text-green-800 mb-2">Experience the power of Gen AI!</h3>
        <p className="text-green-700 mb-4">These AI assistants can transform how we work in manufacturing</p>
        <button
          onClick={onComplete}
          className="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg font-semibold transition-colors duration-200"
        >
          Continue to Tech Demos
        </button>
      </div>
    </div>
  );
};

export default GenAIDemoSection;